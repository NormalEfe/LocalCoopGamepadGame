<!DOCTYPE html>
<html lang="tr">
<head>
    <meta charset="UTF-8">
    <title>Neon Bros: Ultimate Edition</title>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Orbitron:wght@400;700;900&display=swap');

        body { margin: 0; overflow: hidden; background: #050505; font-family: 'Orbitron', sans-serif; }
        canvas { display: block; }
        
        /* UI KATMANI */
        #ui {
            position: absolute; top: 0; left: 0; width: 100%; height: 100%;
            pointer-events: none; display: flex; flex-direction: column; justify-content: space-between;
        }

        /* SKOR TABLOSU */
        .top-bar { display: flex; justify-content: space-between; padding: 20px 50px; text-shadow: 0 0 10px currentColor; font-size: 24px; font-weight: bold; }
        #p1-score { color: #00f7ff; }
        #p2-score { color: #ffaa00; }

        /* ULTƒ∞ BARLARI */
        .bottom-bar { display: flex; justify-content: space-between; padding: 20px 50px; align-items: end; }
        .ulti-container { width: 300px; text-align: left; opacity: 0.8; }
        .ulti-label { color: white; font-size: 14px; margin-bottom: 5px; display: flex; align-items: center; gap: 10px; }
        .ulti-bar-bg { width: 100%; height: 10px; background: #333; border: 2px solid #555; border-radius: 5px; overflow: hidden; }
        .ulti-bar-fill { height: 100%; width: 0%; transition: width 0.1s linear; box-shadow: 0 0 10px currentColor; }
        
        /* TU≈û ƒ∞KONLARI (CSS ƒ∞LE √áƒ∞Zƒ∞M) */
        .btn-icon {
            display: inline-flex; justify-content: center; align-items: center;
            width: 24px; height: 24px; border-radius: 50%; 
            font-size: 14px; font-weight: bold; border: 2px solid; margin-right: 5px;
        }
        /* Xbox X / PS Square Rengi */
        .btn-x { color: #5c7cfa; border-color: #5c7cfa; background: rgba(92, 124, 250, 0.2); }
        .btn-a { color: #40c057; border-color: #40c057; background: rgba(64, 192, 87, 0.2); }

        /* BA≈ûLANGI√á EKRANI */
        #start-screen {
            position: absolute; top: 0; left: 0; width: 100%; height: 100%;
            background: radial-gradient(circle, rgba(10,10,20,0.95) 0%, rgba(0,0,0,1) 100%);
            display: flex; flex-direction: column; align-items: center; justify-content: center;
            color: white; z-index: 10; pointer-events: auto;
        }
        
        h1 { 
            font-size: 70px; margin: 0; letter-spacing: 5px; 
            background: linear-gradient(to right, #00f7ff, #ffffff, #ffaa00);
            -webkit-background-clip: text; color: transparent;
            text-shadow: 0 0 30px rgba(255,255,255,0.3);
            animation: glow 2s ease-in-out infinite alternate;
        }

        .instruction-grid {
            display: grid; grid-template-columns: 1fr 1fr; gap: 40px; margin-top: 50px; text-align: left;
        }
        .inst-box { background: rgba(255,255,255,0.05); padding: 20px; border-radius: 10px; border: 1px solid #333; }
        .inst-title { color: #888; font-size: 12px; margin-bottom: 10px; letter-spacing: 1px; }
        .inst-action { font-size: 20px; display: flex; align-items: center; gap: 10px; margin-bottom: 5px; }

        .status-area { margin-top: 50px; text-align: center; }
        .controller-tag { 
            display: inline-block; padding: 10px 20px; margin: 0 10px; 
            border: 2px solid #333; border-radius: 5px; color: #555; transition: 0.3s;
        }
        .controller-tag.active { border-color: #00f7ff; color: #00f7ff; box-shadow: 0 0 15px #00f7ff44; }
        .ready-text { margin-top: 20px; font-size: 24px; color: #40c057; opacity: 0; transition: 0.3s; }

        @keyframes glow { from { text-shadow: 0 0 10px rgba(255,255,255,0.1); } to { text-shadow: 0 0 30px rgba(255,255,255,0.6); } }
    </style>
</head>
<body>

    <div id="ui">
        <div class="top-bar">
            <span id="p1-score">P1: 0</span>
            <span id="p2-score">P2: 0</span>
        </div>
        
        <div class="bottom-bar">
            <div class="ulti-container">
                <div class="ulti-label">
                    <span class="btn-icon btn-x">X</span> / <span class="btn-icon btn-x" style="border-radius:4px;">‚ñ°</span> ULTƒ∞
                    <span id="p1-ulti-text" style="color:#00f7ff; font-size:10px; margin-left:auto;">HAZIR!</span>
                </div>
                <div class="ulti-bar-bg"><div id="p1-ulti-bar" class="ulti-bar-fill" style="background:#00f7ff; width:100%;"></div></div>
            </div>

            <div class="ulti-container" style="text-align:right;">
                <div class="ulti-label" style="justify-content: flex-end;">
                    <span id="p2-ulti-text" style="color:#ffaa00; font-size:10px; margin-right:auto;">HAZIR!</span>
                    ULTƒ∞ <span class="btn-icon btn-x">X</span> / <span class="btn-icon btn-x" style="border-radius:4px;">‚ñ°</span>
                </div>
                <div class="ulti-bar-bg"><div id="p2-ulti-bar" class="ulti-bar-fill" style="background:#ffaa00; width:100%;"></div></div>
            </div>
        </div>
    </div>

    <div id="start-screen">
        <h1>NEON BROS</h1>
        <div style="font-size: 14px; letter-spacing: 5px; color: #666; margin-top: -10px;">ULTIMATE EDITION</div>

        <div class="instruction-grid">
            <div class="inst-box">
                <div class="inst-title">HAREKET & SALDIRI</div>
                <div class="inst-action">üïπÔ∏è SOL Analog <span style="font-size:14px; color:#aaa;">Y√úR√ú</span></div>
                <div class="inst-action">üïπÔ∏è SAƒû Analog <span style="font-size:14px; color:#aaa;">ATE≈û ET</span></div>
            </div>
            <div class="inst-box">
                <div class="inst-title">√ñZEL YETENEKLER</div>
                <div class="inst-action">
                    <span class="btn-icon btn-x">X</span> / <span class="btn-icon btn-x" style="border-radius:4px;">‚ñ°</span>
                    <span style="font-size:14px; color:#aaa;">≈ûOK DALGASI (ULTƒ∞)</span>
                </div>
                <div class="inst-action">‚ù§Ô∏è <span style="font-size:14px; color:#aaa;">ARKADA≈ûINI KURTAR</span></div>
            </div>
        </div>

        <div class="status-area">
            <div id="p1-tag" class="controller-tag">OYUNCU 1 (KOL YOK)</div>
            <div id="p2-tag" class="controller-tag">OYUNCU 2 (KOL YOK)</div>
            <div id="ready-msg" class="ready-text">
                <span class="btn-icon btn-a">A</span> / <span class="btn-icon btn-a">‚úï</span> BAS VE BA≈ûLA
            </div>
        </div>
    </div>

    <canvas id="gameCanvas"></canvas>

<script>
    const canvas = document.getElementById('gameCanvas');
    const ctx = canvas.getContext('2d');
    
    // UI Elementleri
    const p1UltiBar = document.getElementById('p1-ulti-bar');
    const p2UltiBar = document.getElementById('p2-ulti-bar');
    const p1UltiText = document.getElementById('p1-ulti-text');
    const p2UltiText = document.getElementById('p2-ulti-text');
    const startScreen = document.getElementById('start-screen');
    const p1Tag = document.getElementById('p1-tag');
    const p2Tag = document.getElementById('p2-tag');
    const readyMsg = document.getElementById('ready-msg');

    canvas.width = window.innerWidth;
    canvas.height = window.innerHeight;

    // --- AYARLAR ---
    const P1_COLOR = '#00f7ff';
    const P2_COLOR = '#ffaa00';
    let gameActive = false;
    let shakeTime = 0;

    // --- ≈ûOK DALGASI (ULTƒ∞) SINIFI ---
    class Shockwave {
        constructor(x, y, color) {
            this.x = x; this.y = y;
            this.color = color;
            this.radius = 10;
            this.maxRadius = 400; // Ne kadar b√ºy√ºyecek
            this.speed = 15; // Ne kadar hƒ±zlƒ± b√ºy√ºyecek
            this.active = true;
            this.lineWidth = 10;
            this.alpha = 1;
        }

        update() {
            this.radius += this.speed;
            this.lineWidth *= 0.95; // √áizgi incelsin
            this.alpha -= 0.03; // G√∂r√ºnmez olsun
            if (this.alpha <= 0) this.active = false;

            // D√º≈ümanlarƒ± yok etme kontrol√º
            enemies.forEach((e, index) => {
                let dist = Math.hypot(e.x - this.x, e.y - this.y);
                // Halka d√º≈ümana deƒüdi mi? (Yarƒ±√ßap farkƒ± kontrol√º)
                if (Math.abs(dist - this.radius) < 30) {
                    createExplosion(e.x, e.y, e.color);
                    enemies.splice(index, 1);
                }
            });
        }

        draw() {
            ctx.save();
            ctx.beginPath();
            ctx.arc(this.x, this.y, this.radius, 0, Math.PI * 2);
            ctx.strokeStyle = this.color;
            ctx.lineWidth = this.lineWidth;
            ctx.globalAlpha = this.alpha;
            ctx.shadowBlur = 20;
            ctx.shadowColor = this.color;
            ctx.stroke();
            ctx.restore();
        }
    }

    // --- OYUNCU SINIFI ---
    class Player {
        constructor(id, color) {
            this.id = id;
            this.color = color;
            this.x = canvas.width / 2 + (id === 0 ? -100 : 100);
            this.y = canvas.height / 2;
            this.radius = 20;
            this.speed = 6;
            this.lives = 2;
            this.isDead = false;
            this.invulnerableTime = 0;
            this.reviveProgress = 0;
            this.score = 0;
            
            // ATE≈û Sƒ∞STEMƒ∞
            this.lastShot = 0;
            this.fireRate = 100;
            this.aimAngle = 0;

            // ULTƒ∞ Sƒ∞STEMƒ∞
            this.lastUlti = 0; // Son ulti zamanƒ± (0 = oyun ba≈üƒ± hazƒ±r)
            this.ultiCooldown = 20000; // 20 Saniye (ms cinsinden)
        }

        update(gamepad) {
            if (this.isDead) return;
            if (this.invulnerableTime > 0) this.invulnerableTime--;

            // 1. HAREKET (Sol Stick)
            const moveX = Math.abs(gamepad.axes[0]) > 0.1 ? gamepad.axes[0] : 0;
            const moveY = Math.abs(gamepad.axes[1]) > 0.1 ? gamepad.axes[1] : 0;
            this.x += moveX * this.speed;
            this.y += moveY * this.speed;
            this.constrain();

            // 2. Nƒ∞≈ûAN (Saƒü Stick)
            const aimX = Math.abs(gamepad.axes[2]) > 0.1 ? gamepad.axes[2] : 0;
            const aimY = Math.abs(gamepad.axes[3]) > 0.1 ? gamepad.axes[3] : 0;

            if (aimX !== 0 || aimY !== 0) {
                this.aimAngle = Math.atan2(aimY, aimX);
                const now = Date.now();
                if (now - this.lastShot > this.fireRate) {
                    bullets.push(new Bullet(this.x, this.y, this.aimAngle, this.color));
                    this.lastShot = now;
                    this.x -= Math.cos(this.aimAngle) * 2; // Geri tepme
                    this.y -= Math.sin(this.aimAngle) * 2;
                }
            }

            // 3. ULTƒ∞ KONTROL√ú (Buton 2: Xbox X / PS Kare)
            if (gamepad.buttons[2].pressed) {
                this.triggerUlti();
            }

            // UI G√ºncelleme (Cooldown)
            this.updateUI();
        }

        triggerUlti() {
            const now = Date.now();
            if (now - this.lastUlti > this.ultiCooldown) {
                // ULTƒ∞ AT!
                this.lastUlti = now;
                shockwaves.push(new Shockwave(this.x, this.y, this.color));
                shakeTime = 30; // Ekranƒ± salla
            }
        }

        updateUI() {
            const now = Date.now();
            const timePassed = now - this.lastUlti;
            let percent = Math.min((timePassed / this.ultiCooldown) * 100, 100);
            
            // Eƒüer oyun daha yeni ba≈üladƒ±ysa ve hi√ß ulti atmadƒ±ysa full g√∂ster
            if (this.lastUlti === 0) percent = 100;

            const bar = this.id === 0 ? p1UltiBar : p2UltiBar;
            const text = this.id === 0 ? p1UltiText : p2UltiText;

            bar.style.width = percent + "%";
            
            if (percent >= 100) {
                bar.style.backgroundColor = this.color;
                bar.style.boxShadow = `0 0 10px ${this.color}`;
                text.innerText = "HAZIR! (BAS: X/‚ñ°)";
                text.style.opacity = 1;
            } else {
                bar.style.backgroundColor = "#555";
                bar.style.boxShadow = "none";
                text.innerText = Math.ceil((this.ultiCooldown - timePassed)/1000) + "sn";
                text.style.opacity = 0.5;
            }
        }

        constrain() {
            if(this.x < this.radius) this.x = this.radius;
            if(this.x > canvas.width - this.radius) this.x = canvas.width - this.radius;
            if(this.y < this.radius) this.y = this.radius;
            if(this.y > canvas.height - this.radius) this.y = canvas.height - this.radius;
        }

        takeDamage() {
            if (this.invulnerableTime > 0 || this.isDead) return;
            this.lives--;
            shakeTime = 10;
            if (this.lives <= 0) {
                this.isDead = true;
                this.lives = 0;
                createExplosion(this.x, this.y, this.color);
            } else {
                this.invulnerableTime = 120;
                createExplosion(this.x, this.y, "#ffffff");
            }
        }

        draw() {
            if (this.isDead) {
                // √ñl√º √áizimi
                ctx.save();
                ctx.globalAlpha = 0.3;
                ctx.strokeStyle = this.color;
                ctx.lineWidth = 2;
                ctx.beginPath(); ctx.arc(this.x, this.y, this.radius, 0, Math.PI*2); ctx.stroke();
                
                ctx.font = "12px Orbitron"; ctx.fillStyle = "white"; ctx.textAlign = "center";
                ctx.fillText("KURTAR", this.x, this.y - 35);
                
                if(this.reviveProgress > 0) {
                    ctx.fillStyle = "#00ff00";
                    ctx.fillRect(this.x - 20, this.y + 35, (this.reviveProgress/100)*40, 5);
                }
                ctx.restore();
                return;
            }

            if (this.invulnerableTime > 0 && Math.floor(Date.now() / 50) % 2 === 0) return;

            ctx.save();
            ctx.shadowBlur = 15; ctx.shadowColor = this.color; ctx.fillStyle = this.color;
            ctx.beginPath(); ctx.arc(this.x, this.y, this.radius, 0, Math.PI * 2); ctx.fill();

            // Ni≈üan Lazer
            ctx.shadowBlur = 0; ctx.strokeStyle = "rgba(255, 255, 255, 0.5)"; ctx.lineWidth = 2;
            ctx.beginPath(); ctx.moveTo(this.x, this.y);
            ctx.lineTo(this.x + Math.cos(this.aimAngle) * 40, this.y + Math.sin(this.aimAngle) * 40);
            ctx.stroke();
            
            // Can Kalpleri
            ctx.font = "14px Arial"; ctx.fillStyle = "#ff3333"; ctx.textAlign = "center";
            let hearts = ""; for(let i=0; i<this.lives; i++) hearts += "‚ù§";
            ctx.fillText(hearts, this.x, this.y - 30);

            // ƒ∞sim
            ctx.fillStyle = "#000"; ctx.font = "bold 10px Orbitron"; ctx.textBaseline = "middle";
            ctx.fillText(this.id === 0 ? "P1" : "P2", this.x, this.y);
            ctx.restore();
        }
    }

    // --- YARDIMCI SINIFLAR ---
    class Bullet {
        constructor(x, y, angle, color) {
            this.x = x + Math.cos(angle)*20; this.y = y + Math.sin(angle)*20;
            this.vx = Math.cos(angle)*15; this.vy = Math.sin(angle)*15;
            this.color = color; this.radius = 4;
        }
        update() { this.x += this.vx; this.y += this.vy; }
        draw() {
            ctx.save(); ctx.shadowBlur = 10; ctx.shadowColor = this.color; ctx.fillStyle = "white";
            ctx.beginPath(); ctx.arc(this.x, this.y, this.radius, 0, Math.PI*2); ctx.fill(); ctx.restore();
        }
    }

    class Enemy {
        constructor() {
            if (Math.random() < 0.5) { this.x = Math.random()<0.5?-30:canvas.width+30; this.y = Math.random()*canvas.height; }
            else { this.x = Math.random()*canvas.width; this.y = Math.random()<0.5?-30:canvas.height+30; }
            this.radius = 15; this.speed = Math.random()*2 + 1; this.color = '#ff0044';
        }
        update() {
            let target = null;
            let d1 = players[0].isDead ? Infinity : Math.hypot(players[0].x-this.x, players[0].y-this.y);
            let d2 = players[1].isDead ? Infinity : Math.hypot(players[1].x-this.x, players[1].y-this.y);
            if(d1===Infinity && d2===Infinity) return;
            target = d1 < d2 ? players[0] : players[1];
            let angle = Math.atan2(target.y-this.y, target.x-this.x);
            this.x += Math.cos(angle)*this.speed; this.y += Math.sin(angle)*this.speed;
        }
        draw() {
            ctx.save(); ctx.shadowBlur = 10; ctx.shadowColor = this.color; ctx.fillStyle = this.color;
            ctx.fillRect(this.x-this.radius, this.y-this.radius, this.radius*2, this.radius*2); ctx.restore();
        }
    }

    class Particle {
        constructor(x, y, color) {
            this.x = x; this.y = y; this.vx = (Math.random()-0.5)*10; this.vy = (Math.random()-0.5)*10;
            this.life = 1.0; this.color = color;
        }
        update() { this.x+=this.vx; this.y+=this.vy; this.life-=0.04; }
        draw() {
            ctx.save(); ctx.globalAlpha = this.life; ctx.fillStyle = this.color;
            ctx.beginPath(); ctx.arc(this.x, this.y, 3, 0, Math.PI*2); ctx.fill(); ctx.restore();
        }
    }

    // --- OYUN DEƒûƒ∞≈ûKENLERƒ∞ ---
    const players = [new Player(0, P1_COLOR), new Player(1, P2_COLOR)];
    let bullets = []; let enemies = []; let particles = []; let shockwaves = [];
    let spawnTimer = 0; let spawnRate = 50;

    function createExplosion(x, y, color) {
        for(let i=0; i<15; i++) particles.push(new Particle(x, y, color));
    }

    function checkRevive() {
        [0, 1].forEach(i => {
            let me = players[i]; let other = players[i===0?1:0];
            if (me.isDead && !other.isDead) {
                let d = Math.hypot(me.x - other.x, me.y - other.y);
                if (d < 60) {
                    me.reviveProgress += 1.5;
                    if(me.reviveProgress >= 100) {
                        me.isDead = false; me.lives = 2; me.reviveProgress = 0; me.invulnerableTime = 180;
                        createExplosion(me.x, me.y, '#00ff00'); shakeTime = 20;
                    }
                } else me.reviveProgress = 0;
            }
        });
    }

    // --- ANA D√ñNG√ú ---
    function loop() {
        requestAnimationFrame(loop);
        const gamepads = navigator.getGamepads ? navigator.getGamepads() : [];

        // MEN√ú MANTIƒûI
        if (!gameActive) {
            let p1Con = gamepads[0] != null;
            let p2Con = gamepads[1] != null;
            
            if(p1Con) { p1Tag.innerText = "OYUNCU 1 HAZIR"; p1Tag.classList.add('active'); }
            else { p1Tag.innerText = "OYUNCU 1 (KOL YOK)"; p1Tag.classList.remove('active'); }
            
            if(p2Con) { p2Tag.innerText = "OYUNCU 2 HAZIR"; p2Tag.classList.add('active'); }
            else { p2Tag.innerText = "OYUNCU 2 (KOL YOK)"; p2Tag.classList.remove('active'); }

            if (p1Con && p2Con) {
                readyMsg.style.opacity = 1;
                // Buton 0 = A / Cross
                if (gamepads[0].buttons[0].pressed || gamepads[1].buttons[0].pressed) {
                    gameActive = true;
                    startScreen.style.opacity = 0;
                    setTimeout(()=>startScreen.style.display='none', 500);
                }
            } else {
                readyMsg.style.opacity = 0;
            }
            return;
        }

        // OYUN ƒ∞√áƒ∞
        ctx.fillStyle = "#050505"; ctx.fillRect(0,0,canvas.width, canvas.height);
        
        // Sarsƒ±ntƒ±
        if(shakeTime > 0) { ctx.save(); ctx.translate((Math.random()-0.5)*15, (Math.random()-0.5)*15); shakeTime--; }

        // Grid Efekti
        ctx.strokeStyle = "#111"; ctx.lineWidth = 2; ctx.beginPath();
        for(let x=0; x<canvas.width; x+=50) { ctx.moveTo(x,0); ctx.lineTo(x,canvas.height); }
        for(let y=0; y<canvas.height; y+=50) { ctx.moveTo(0,y); ctx.lineTo(canvas.width,y); }
        ctx.stroke();

        if(gamepads[0]) players[0].update(gamepads[0]);
        if(gamepads[1]) players[1].update(gamepads[1]);
        checkRevive();
        
        // Objeler
        shockwaves.forEach((s, i) => { if(s.active) { s.update(); s.draw(); } else shockwaves.splice(i, 1); });
        players[0].draw(); players[1].draw();

        spawnTimer++;
        if(spawnTimer > spawnRate) { enemies.push(new Enemy()); spawnTimer = 0; if(spawnRate > 10) spawnRate -= 0.05; }

        for (let i = bullets.length - 1; i >= 0; i--) {
            let b = bullets[i]; b.update(); b.draw();
            if(b.x<0 || b.x>canvas.width || b.y<0 || b.y>canvas.height) { bullets.splice(i,1); continue; }
            for (let j = enemies.length - 1; j >= 0; j--) {
                let e = enemies[j];
                if (Math.hypot(b.x-e.x, b.y-e.y) < e.radius+b.radius) {
                    createExplosion(e.x, e.y, e.color);
                    enemies.splice(j, 1); bullets.splice(i, 1);
                    if(b.color===P1_COLOR) players[0].score+=10; else players[1].score+=10;
                    break;
                }
            }
        }

        for (let i = enemies.length - 1; i >= 0; i--) {
            let e = enemies[i]; e.update(); e.draw();
            players.forEach(p => {
                if (!p.isDead && p.invulnerableTime <= 0) {
                    if (Math.hypot(p.x-e.x, p.y-e.y) < p.radius+e.radius) {
                        p.takeDamage(); createExplosion(e.x, e.y, e.color); enemies.splice(i, 1);
                    }
                }
            });
        }

        particles.forEach((p, i) => { p.update(); p.draw(); if(p.life<=0) particles.splice(i,1); });

        if(shakeTime > 0) ctx.restore();

        // UI
        document.getElementById('p1-score').innerText = `P1: ${players[0].score}`;
        document.getElementById('p2-score').innerText = `P2: ${players[1].score}`;

        if(players[0].isDead && players[1].isDead) {
            ctx.fillStyle = "rgba(0,0,0,0.7)"; ctx.fillRect(0,0,canvas.width, canvas.height);
            ctx.fillStyle = "white"; ctx.font = "bold 60px Orbitron"; ctx.textAlign = "center";
            ctx.fillText("OYUN Bƒ∞TTƒ∞", canvas.width/2, canvas.height/2);
            ctx.font = "20px Orbitron"; ctx.fillText("Yeniden ba≈ülamak i√ßin F5", canvas.width/2, canvas.height/2 + 60);
        }
    }
    loop();
    window.addEventListener('resize', () => { canvas.width = window.innerWidth; canvas.height = window.innerHeight; });
</script>
</body>
</html>
